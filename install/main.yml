---
- hosts: localhost
  remote_user: root
  roles:
    - role_oracledb

  vars_prompt:
    - name: 'oracledb_version_selection'
      prompt: "\nPlease choose the number for OracleDB version [ 1/2 ] \n\n
      1: oracle database ee 18c(not support)\n
      2: oracle database ee 19c(support)\n"
      private: no
      default: 1
 
    - name: 'oracledb_package_dir'
      prompt: "\nPlease input your OracleDB package path (e.g /data/oracle-database-ee-19c-1.0-1.x86_64.rpm): \n\n"
      private: no
      default: 1

    - name: 'oracledb_official_selection'
      prompt: "\n Have you reviewed and accept the Oracle License Agreement\n
      https://www.oracle.com/technetwork/licenses/standard-license-152015.html#licenseContent [ y/n ] \n\n
      Yes, I have reviewed and accept the Oracle License Agreement \n
      No, I have not reviewed and accept the Oracle License Agreement\n"
      private: no

    - name: 'oracledb_password'
      prompt: "\nPlease input your OracleDB password: \n\n"
      private: yes

  vars:
    oracledb_official_select:
      'Y': True
      'y': True
      'N': False
      'n': False
    oracledb_official: "{{oracledb_official_select[oracledb_official_selection]}}"

    oracledb_version_select:
      '1': '18c'
      '2': '19c'
    oracledb_version: "{{oracledb_version_select[oracledb_version_selection]}}"

  pre_tasks:
   - fail: msg="Please reviewed and accept the Oracle License Agreement"
     when: not oracledb_official

   - fail: msg="exit, You did not enter the location of the OracleDB package"
     when: oracledb_package_dir is none

   - name: Check whether the oracledb package type
     shell: >
       file {{oracledb_package_dir}} |awk '{print $2}'
     register: oracledb_package_type

   - fail: msg="Please download the RPM version of OracleDB"  
     when: oracledb_package_type.stdout !="RPM"

   - debug:
       msg: Will install oracle {{oracledb_version}} database 

  roles:
    - {role: role_oracledb, tags: "role_oracledb"}  
